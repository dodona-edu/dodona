<%= content_for :javascripts do %>
  <%= javascript_include_tag 'course' %>
<% end %>
<%= render partial: 'courses/navbar_links' %>
<div class="row">
  <div class="col-12">
    <div class="card">
      <div class="card-title card-title-colored">
        <h2 class="card-title-text"><%= @course.name + " - " + t("courses.show.users") %></h2>
      </div>
      <div class="card-supporting-text card-border">
        <%
          tabs = []
          tabs << { id: 'enrolled', name: t('courses.show.subscribed') }
          tabs << { id: 'pending', name: t('courses.show.pending'), count: @course.pending_members.count } if @course.moderated || !@course.pending_members.empty?
          tabs << { id: 'unsubscribed', name: t('courses.show.unsubscribed') }
        %>
        <d-filter-tabs labels="<%= tabs.to_json %>" param="status"></d-filter-tabs>
        <% content_for :modal do %>
          <div class="modal fade" id="labelsUploadModal" tabindex="-1" role="dialog" data-course_id="<%= @course.id %>">
            <div class="modal-dialog" role="document">
              <div class="modal-content">
                <div class="modal-header">
                  <h4 class="modal-title"><%= t(".edit_all_labels") %></h4>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="<%= t(".close") %>"></button>
                </div>
                <div class="modal-body">
                  <ol>
                    <li>
                      <p>
                        <%= t ".first_download_labels" %>
                      </p>
                      <p>
                        <a class="btn btn-outline" href="<%= course_members_path(@course, format: :csv) %>"><%= t ".download" %>
                        </a>
                      </p>
                    </li>
                    <li>
                      <p>
                        <%= t ".then_edit" %>
                      </p>
                    </li>
                    <li>
                      <p>
                        <%= t ".finally_upload" %>
                      </p>
                      <input type="file" id="newCsvFileInput"/>
                    </li>
                  </ol>
                </div>
                <div class="modal-footer">
                  <button id="labelsUploadButton" type="button" class="btn btn-filled"><%= t(".upload") %></button>
                </div>
              </div>
            </div>
          </div>
        <% end %>
        <%= render partial: 'layouts/searchbar',
                   locals: {
                       eager: false,
                       actionFilter: 'status',
                       actions: [
                           {
                               icon: 'check',
                               text: t("courses.show.accept_all"),
                               confirm: t("courses.show.confirm_accept_all"),
                               action: mass_accept_pending_course_path(@course),
                               filterValue: 'pending'
                           },
                           {
                               icon: 'minus',
                               text: t("courses.show.decline_all"),
                               confirm: t("courses.show.confirm_decline_all"),
                               action: mass_decline_pending_course_path(@course),
                               filterValue: 'pending'
                           },
                           {
                               icon: 'palette-swatch',
                               text: t(".edit_all_labels"),
                               js: 'bootstrap.Modal.getOrCreateInstance(document.querySelector("#labelsUploadModal")).show()',
                               filterValue: 'enrolled'
                           },
                           {
                               icon: 'cloud-download',
                               text: t(".download_user_csv"),
                               url: course_members_path(@course, format: :csv),
                           }
                       ],
                   } %>
        <div id="users-table-wrapper">
          <%= render partial: 'members_table',
                     locals: {
                         course_memberships: @course_memberships,
                         pagination_opts: @pagination_opts
                     } %>
        </div>
      </div>
    </div>
  </div>
</div>
<script type="text/javascript">
    dodona.ready.then(dodona.initCourseMembers);
</script>
