<%= content_for :javascripts do %>
  <%= javascript_pack_tag 'course' %>
<% end %>

<div class="row">
  <%= link_to '#series', class: "btn btn-lg btn-down col-sm-1 hidden-xs", title: t('.series') do %>
    <span class='hidden-sm'><%= t ".series" %></span><br>
    <span class="glyphicon glyphicon-chevron-down"></span>
  <% end %>

  <div class="col-sm-10 col-xs-12">
    <div class="card">
      <div class="card-title card-title-colored">
        <h2 class="card-title-text"><%= @course.name %> (<%= @course.formatted_year %>)</h2>
        <div class="card-title-fab">
          <% if policy(@course).edit? %>
              <%= render 'fab_link', url: edit_course_path(@course), icon: 'pencil' %>
          <% end %>
        </div>
      </div>
      <div class="card-supporting-text row">
        <div class="col-sm-<%= current_user&.member_of?(@course).! ? '6' : '12' %> col-xs-12">
          <%= markdown(@course.description) %>
          <% if current_user&.member_of? @course %>
            <%= button_to t('.unsubscribe'),
              unsubscribe_course_path(@course),
              class: 'btn-text pull-right',
              data: { confirm: t('general.are_you_sure') } %>
          <% end %>
        </div>
        <% if current_user&.member_of?(@course).! %>
          <%= render partial: 'not_a_member_card' %>
        <% end %>
      </div>
      <% if current_user&.course_admin?(@course) %>
        <div class="card-supporting-text card-border">
          <div class="row">
            <div class="col-md-6">
              <div class="row">
                <div class="col-xs-6 admin-card-stat">
                    <%= t ".subscribed_users" %>
                    <h1>
                      <%= @course.subscribed_members.count %>
                    </h1>
                </div>
                <div class="col-xs-6 admin-card-stat">
                    <%= t ".exercise_count" %>
                    <h1>
                      <%= @course.exercises.count %>
                    </h1>
                </div>
              </div>
              <div class="row">
                <div class="col-xs-6 admin-card-stat">
                    <%= t ".submitted_solutions" %>
                    <h1>
                      <%= number_with_delimiter @course.submissions.count, delimiter: "â€‰" %>
                    </h1>
                </div>
                <div class="col-xs-6 admin-card-stat"
                     title="<%= t '.average_progress_info'%>">
                    <%= t ".average_progress" %>
                  <h1>
                    <%= number_to_percentage @course.average_progress, precision: 1 %>
                  </h1>
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <p>
              <%= t ".invitation_link" %>
              <span class="glyphicon glyphicon-info-sign" title="<%= t ".invitation_link_help" %>">
              </span>
              <div class="input-group input-group-sm">
                <%= text_field_tag :registration_link, registration_course_url(@course, @course.secret), readonly: true, class: 'form-control' %>
                <span class="input-group-btn">
                  <%= clipboard_button_for :registration_link %>
                </span>
              </div>
              <div class="admin-card-info">
                <span class="help-block">
                  <%= t ".visibility-#{@course.visibility}-info_html" %>
                </span>
                <span class="help-block">
                  <%= t ".registration-#{@course.registration}-info_html" %>
                </span>
              </div>
            </div>
          </div>
          </span>
          <% if policy(@course).scoresheet? %>
            <%= link_to t(".download_scoresheet"), scoresheet_course_path(@course), class: 'btn-text pull-right' %>
          <% end %>
        </div>
      <% end %>
      <% if policy(@course).show_series? %>
        <div class="card-supporting-text card-border">
          <div class="card-subtitle">
            <a class="anchor" id="series"></a>
            <h3><%= t ".exercise_series" %></h3>
            <div class="flex-spacer"></div>
            <div class="card-subtitle-actions">
              <% if policy(@course).add_series? %>
                <%= link_to new_course_series_path(@course), title: t("series.new.title") do %>
                  <span class='glyphicon glyphicon-plus pull-right'></span>
                <% end %>
              <% end %>
            </div>
          </div>
          <div id="series-listing">
            <% @series.each do |series| %>
              <%= render(partial: 'series/series', locals: {series: series}) %>
            <% end %>
          </div>
          <% if @total_series > @series.length %>
            <div class="text-center"><button class='btn btn-text load-more-series' data-loading-text="<%= t("series.index.loading_more") %>"><%= t("series.index.load_more") %></button></div>
          <% end %>
        </div>
      <% end %>
    </div>
  </div>
</div>
<script type="text/javascript">
  $(function () {
    dodona.initCourseShow(<%= @series.length %>, <%= @total_series %>, true);
  });
</script>
