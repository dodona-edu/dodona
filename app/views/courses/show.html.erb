<%= content_for :javascripts do %>
  <%= javascript_pack_tag 'course' %>
<% end %>
<%= render partial: 'navbar_links' %>
<div class="row">
  <div class="col-sm-offset-1 col-sm-10 col-xs-12">
    <div class="card">
      <div class="card-title card-title-colored">
        <h2 class="card-title-text">
          <%= @course.name %> (<%= @course.formatted_year %>)
        </h2>
        <% if @course.institution&.name.present? || @course.teacher.present? %>
          <h3 class="card-subtitle-text">
            <% if @course.institution&.name.present? && @course.teacher.present? %>
              <%= t(".taught_by_at", {teacher: @course.teacher, institution: @course.institution.name}) %>
            <% elsif @course.institution&.name.present? %>
              <%= t(".taught_at", {institution: @course.institution.name}) %>
            <% elsif @course.teacher.present? %>
              <%= t(".taught_by", {teacher: @course.teacher}) %>
            <% end %>
          </h3>
        <% end %>
      </div>
      <div class="card-supporting-text card-border row">
        <div class="col-sm-<%= current_user&.member_of?(@course).! ? '6' : '12' %> col-xs-12">
          <%= markdown(@course.description) %>
          <% if current_user&.member_of? @course %>
            <%= button_to t('.unsubscribe'),
                          unsubscribe_course_path(@course),
                          class: 'btn-text pull-right',
                          data: {confirm: t('general.are_you_sure')} %>
          <% end %>
        </div>
        <% if current_user&.member_of?(@course).! %>
          <%= render partial: 'not_a_member_card' %>
        <% end %>
      </div>
      <% if current_user&.course_admin?(@course) %>
        <div class="card-supporting-text card-border">
          <div class="row">
            <div class="col-md-6">
              <div class="row">
                <div class="col-xs-6 admin-card-stat">
                  <%= t ".subscribed_users" %>
                  <h1>
                    <%= @course.subscribed_members_count %>
                  </h1>
                </div>
                <div class="col-xs-6 admin-card-stat">
                  <%= t ".exercise_count" %>
                  <h1>
                    <%= @course.exercises_count %>
                  </h1>
                </div>
              </div>
              <div class="row">
                <div class="col-xs-6 admin-card-stat">
                  <%= t ".submitted_solutions" %>
                  <h1>
                    <%= number_with_delimiter @course.submissions.count, delimiter: "â€‰" %>
                  </h1>
                </div>
                <div class="col-xs-6 admin-card-stat"
                     title="<%= t '.average_progress_info' %>">
                  <%= t ".average_progress" %>
                  <h1>
                    <%= number_to_percentage @course.average_progress, precision: 1 %>
                  </h1>
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <p>
                <%= t ".invitation_link" %>
                <i title="<%= t ".invitation_link_help" %>" class="material-icons md-18 material-icons-info">info</i>
              <div class="input-group input-group-sm">
                <%= text_field_tag :registration_link, registration_course_url(@course, @course.secret), readonly: true, class: 'form-control' %>
                <span class="input-group-btn">
                    <%= clipboard_button_for :registration_link %>
                  </span>
              </div>
              <div class="admin-card-info">
                  <span class="help-block">
                    <%= t ".visibility-#{@course.visibility}-info_html" %>
                  </span>
                <span class="help-block">
                    <%= t ".registration-#{@course.registration}-info_html" %>
                  </span>
              </div>
            </div>
          </div>
          </span>
          <% if policy(@course).scoresheet? %>
            <%= link_to t(".download_scoresheet"), scoresheet_course_path(@course), class: 'btn-text pull-right' %>
          <% end %>
        </div>
      <% end %>
    </div>
    <% if policy(@course).show_series? %>
      <div class="page-subtitle">
        <a class="anchor" id="series"></a>
        <h3><%= t ".exercise_series" %></h3>
        <div class="flex-spacer"></div>
        <div>
          <% if policy(@course).add_series? %>
            <%= link_to new_course_series_path(@course), title: t("series.new.title"), class: "btn with-text btn-primary btn-fab-extended" do %>
              <i class="material-icons icon">add</i><span class='text'><%= t("series.new.title") %></span>
            <% end %>
          <% end %>
        </div>
      </div>
      <div id="series-listing">
        <% @series.first(@series_loaded).each do |series| %>
          <%= render(partial: 'series/series', locals: {series: series, loaded: true}) %>
        <% end %>
        <% @series.offset(@series_loaded).each do |series| %>
          <%= render(partial: 'series/series', locals: {series: series, loaded: false}) %>
        <% end %>
      </div>
    <% end %>
  </div>
</div>
<script type="text/javascript">
    $(dodona.initCourseShow);
</script>
