<!-- opgave -->
<div class="row">
  <div class="col-sm-10 col-sm-offset-1 col-xs-12">
    <div class="card exercise-description">
      <div class="card-title card-title-colored">
        <h2 class="card-title-text"><%= @exercise.name.titleize %></h2>
        <% if policy(@exercise).edit? %>
          <div class="card-title-fab">
            <%= link_to edit_exercise_path(@exercise.name), class: "btn btn-primary btn-fab" do %>
              <span class="glyphicon glyphicon-pencil"></span>
            <% end %>
          </div>
        <% end %>
      </div>
      <div class="card-supporting-text">
        <%= markdown(@exercise.description) %>
      </div>
    </div>
  </div>
</div>
<div class="row">
  <div class="col-sm-10 col-sm-offset-1 col-xs-12">
    <div class="card card-nav">
      <div class="card-title card-title-colored">
        <div class="card-title-fab">
          <% if user_signed_in? %>
          <button class="btn btn-primary btn-fab" id="editor-process-btn">
            <span class="glyphicon glyphicon-play"></span>
          </button>
          <% end %>
        </div>
        <ul class="nav nav-tabs">
          <li class="active"><a href="#code" data-toggle="tab"><%= t ".code"%></a></li>
          <li><a href="#feedback" data-toggle="tab" id='exercise-feedback-link'><%= t ".feedback"%></a></li>
          <li><a href="#submissions" data-toggle="tab" id='exercise-submission-link'><%= t ".solutions"%></a></li>
          <div class="spinner" id="feedback-loading"></div>
        </ul>
      </div>
      <div class="card-supporting-text">
        <div class="tab-content">
          <div class="tab-pane fade in active" id="code">
            <% if !user_signed_in? %>
              <div class="alert alert-info"><%= t ".not_logged_in"%></div>
            <% end %>
            <div id="editor-window">
              <div id="editor-text"></div>
            </div>
          </div>
          <div class="tab-pane fade" id="feedback">
          <% if !user_signed_in? %>
            <div class="alert alert-info"><%= t ".not_logged_in"%></div>
          <% end %>
            <div id="feedback-menu">
              <div class="btn-group">
                <span class="dropdown">
                  <button class="btn btn-sm btn-primary dropdown-toggle" type="button" id="feedback-menu-btn" data-toggle="dropdown" aria-expanded="true">
                    <span class="glyphicon glyphicon-menu-hamburger"></span>
                  </button>
                  <ul class="dropdown-menu dropdown-menu-left" role="menu" aria-labelledby="feedback-menu-btn">
                    <li role="presentation" id="feedback-menu-toggle-correct"><a role="menuitem" tabindex="-1" href="#"><%= t ".hide_correct"%></a></li>
                  </ul>
                </span>
              </div>
              <%= t ".correct"%> <span class="badge" id="tests-correct">0</span>
              <%= t ".wrong"%> <span class="badge" id="tests-wrong">0</span><br>
            </div>
            <table class="table table-condensed">
              <tbody id="feedback-table"></tbody>
            </table>
          </div>
          <div class="tab-pane fade" id="submissions">
            <% if !user_signed_in? %>
              <div class="alert alert-info"><%= t ".not_logged_in"%></div>
            <% elsif @submissions.length > 0 %>
            <div id="submissions-table-wrapper">
              <%= render partial: 'submissions/submissions_table', locals: {submissions: @submissions, exercise: @exercise}  %>
            </div>
            <% else %>
              <div class="alert alert-info"><%= t ".hand_in_tooltip"%></div>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<script type="text/javascript">
  $(function () {
    init_exercise_show(<%= @exercise.id %>, <%= user_signed_in? %>, `<%= raw(@exercise.tests.gsub('\\', '\\\\\\\\').gsub("$","\\$").gsub("{","\\{")) %>`);
  });
</script>
