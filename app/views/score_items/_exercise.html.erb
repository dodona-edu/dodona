<% content_for :javascripts do %>
  <%= javascript_include_tag 'score_item' %>
<% end %>
<% maximum_score = evaluation_exercise.maximum_score %>
<div class="score-items" id="score-items-<%= evaluation_exercise.id %>">
  <h4 class="d-flex justify-content-between">
    <%= evaluation_exercise.exercise.name %>
    <a class="btn btn-icon"
       data-bs-toggle="collapse"
       data-bs-target=".toggle-score-items-<%= evaluation_exercise.id %>">
      <i class="mdi mdi-pencil"></i>
    </a>
  </h4>

  <table class="table table-resource score-items-table toggle-score-items-<%= evaluation_exercise.id %> collapse show" id="table-for-<%= evaluation_exercise.id %>">
    <thead>
    <tr>
      <th><%= ScoreItem.human_attribute_name(:name) %></th>
      <th><%= ScoreItem.human_attribute_name(:description) %></th>
      <th><%= ScoreItem.human_attribute_name(:maximum) %></th>
      <th><%= ScoreItem.human_attribute_name(:visible) %></th>
    </tr>
    </thead>
    <tbody>
    <% if evaluation_exercise.score_items.empty? %>
      <tr>
        <td class="placeholder-text" colspan="5"><%= t 'score_items.exercise.nothing' %></td>
      </tr>
    <% else %>
      <% evaluation_exercise.score_items.each do |score_item| %>
        <tr>
          <td class="name"><%= score_item.name %></td>
          <td class="description"><%= markdown score_item.description %></td>
          <td class="maximum"><%= format_score score_item.maximum %></td>
          <td class="visibility">
            <%= form_for [@evaluation, score_item], namespace: "#{evaluation_exercise.id}_#{score_item.id}", method: :patch, remote: :true do |f| %>
              <%= f.check_box :visible, class: "form-check-input visibility-checkbox", title: t(".visibility") %>
            <% end %>
          </td>
        </tr>
      <% end %>
    <% end %>
    <tr class="maximum-row">
      <td colspan="2" class="wide-description"><%= t '.max' %></td>
      <td class="maximum">
        <%= format_score maximum_score %>
      </td>
      <td class="visibility">
        <%= form_for evaluation_exercise, namespace: evaluation_exercise.id, method: :patch, remote: :true do |f| %>
          <%= f.check_box :visible_score,
                          class: "form-check-input total-visibility-checkbox",
                          disabled: maximum_score.nil?,
                          title: t(".total_visibility") %>
        <% end %>
      </td>
    </tr>
    </tbody>

  </table>
  <d-score-item-input-table
    class="toggle-score-items-<%= evaluation_exercise.id %> collapse"
    route="<%=evaluation_evaluation_exercise_score_items_path(@evaluation.id, evaluation_exercise.id, format: :js) %>"
    score-items="<%= evaluation_exercise.score_items.to_json %>"
  ></d-score-item-input-table>
</div>
<script>
    window.dodona.initVisibilityCheckboxes(document.getElementById("score-items-<%= evaluation_exercise.id %>"));
</script>
