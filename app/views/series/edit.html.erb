<% content_for :javascripts do %>
  <%= javascript_pack_tag 'series' %>
<% end %>
<div class="row">
  <div class="col-sm-10 col-sm-offset-1 col-xs-12">
    <div class="card">
      <div class="card-title card-title-colored">
        <h2 class="card-title-text"><%= @series.name %></h2>
        <div class="card-title-fab">
          <%= render 'fab_button', form: "edit_series_#{@series.id}", icon: 'done' %>
        </div>
      </div>
      <div class="card-supporting-text row">
        <div class="col-xs-12 col-sm-8">
          <%= render 'form', series: @series %>
        </div>
      </div>
      <% if @series.indianio_token || @series.access_token %>
      <div class="card-supporting-text card-border">
        <h4><%= t '.confidential' %></h4>
        <div class="col-xs-12 col-sm-10">
          <div class="form-horizontal">
            <% if @series.indianio_token %>
            <div class="field form-group">
              <%= label_tag :indianio_token, 'Indianio token', class: 'col-sm-3 control-label' %>
              <div class="col-sm-9">
                <div class="input-group" id="indianio_token">
                  <%= render partial: 'token_field' ,
                      locals: {
                        name: :indianio_token,
                        value: @series.indianio_token,
                        reset_url: reset_token_series_path(@series, type: :indianio_token)
                  } %>
                </div>
              </div>
              <span class="help-block col-sm-offset-3 col-sm-9">
                <%= t '.indianio-help' %>
              </span>
            </div>
            <% end %>
            <% if @series.access_token %>
            <div class="field form-group">
              <%= label_tag :access_token, t('.access-link'), class: 'col-sm-3 control-label' %>
              <div class="col-sm-9">
                <div class="input-group" id="access_token">
                  <%= render partial: 'token_field' ,
                    locals: {
                    name: :access_token,
                    value: series_url(@series, token: @series.access_token),
                  reset_url: reset_token_series_path(@series, type: :access_token)
                  } %>
                </div>
              </div>
              <span class="help-block col-sm-offset-3 col-sm-9">
                <%= t '.access-help' %>
              </span>
            </div>
            <% end %>
          </div>
        </div>
      </div>
      <% end %>
      <% if policy(@series).modify_exercises? %>
        <div class="card-supporting-text card-border row">
          <div class="col-xs-12 col-sm-6 col-sm-push-6">
            <h4><%= t ".exercises_in_series" %></h4>
            <div class="row series-exercise-list">
              <% @series.exercises.each do |exercise| %>
                <div class="col-xs-12 row exercise">
                  <div class='col-xs-1 drag-handle'>
                    <i class='material-icons md-18'>reorder</i>
                  </div>
                  <div class='col-xs-9'><%= link_to exercise.name, exercise, target: "_blank" %></div>
                  <div class='actions col-xs-2'>
                    <a href="#" class="btn btn-icon remove-exercise" title="<%= t "series.edit.remove_exercise" %>" data-exercise_id="<%= exercise.id %>" data-series_id="<%= @series.id %>" data-exercise_name="<%= exercise.name %>">
                      <i class='material-icons md-18'>delete</i>
                    </a>
                  </div>
                </div>
              <% end %>
            </div>
          </div>
          <div class="col-xs-12 col-sm-6 col-sm-pull-6">
            <h4><%= t ".add_exercises" %></h4>
            <%= render partial: 'layouts/searchbar', locals: { baseUrl: exercises_path(:series_id => @series.id), eager: true, tags: @tags }  %>
            <div id="exercises-table-wrapper">
            </div>
          </div>
        </div>
      <% end %>
    </div>
  </div>
</div>
<script type="text/javascript">
  $(function () {
    dodona.initSeriesEdit();
  });
</script>
