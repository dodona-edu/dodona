<div class="row">
  <div class="col-sm-10 col-sm-offset-1 col-xs-12">
    <div class="card profile">
      <div class="card-supporting-text">
        <div>
          <span class="user-icon pull-left"><i class="material-icons md-36" title="<%= @user.permission %>">
            <% if @user.permission == "student" %>
              person
            <% elsif @user.permission == "staff" %>
              school
            <% else %>
              android
            <% end %>
          </i></span>
          <span class="profile-line">
            <span class="name">
              <%= @user.full_name %>
            </span>
            <% if @user.username.present? %>
              <span>(<%= @user.username %>)</span>
            <% end %>
          </span>
          <span class="profile-byline text-muted">
            <%= @user.institution&.name %>
            <% if @user.institution&.name.present? and @user.email.present? %>
              &middot;
            <% end %>
            <%= @user.email %>
          </span>
          <p class="timezone">
            <%= t ".timezone" %> <b><%= @user.time_zone %></b>.
          </p>
        </div>
        <% if @user.token.present? %>
          <div class="callout callout-warning">
            <h4><%= t ".sign_in" %></h4>
            <p><%= t ".token_sign_in" %></p>
            <p><%= token_sign_in_user_url(@user, @user.token) %></p>
          </div>
        <% end %>
        <div class="row">
          <div class="col-sm-12 col-md-6">
            <h4><%= t ".stats" %></h4>
            <div class="row">
              <div class="col-xs-6 stat">
                <a class="card-title-link" href="<%= user_submissions_path(@user) %>">
                  <h1><%= @user.submissions.count %></h1>
                  <%= t ".submissions" %>
                </a>
              </div>
              <div class="col-xs-6 stat">
                <h1><%= @user.subscribed_courses.count %></h1>
                <%= t ".courses" %>
              </div>
              <div class="col-xs-6 stat">
                <h1><%= @user.correct_exercises %></h1>
                <%= t ".correctly_solved" %>
              </div>
              <div class="col-xs-6 stat">
                <h1><%= @user.unfinished_exercises %></h1>
                <%= t ".unfinished" %>
              </div>
            </div>
          </div>
          <div class="col-sm-12 col-md-offset-1 col-md-5">
            <h4><%= t ".my_courses" %></h4>
            <% if @user.subscribed_courses.empty? %>
              <%= t ".no_courses" %>
            <% else %>
              <% @user.subscribed_courses.each do |course| %>
                <p>
                  <div>
                    <%= link_to course.name, course, class: "course-link", title: course.name %>
                    <% if course.teacher.present? %>
                      <span class="text-muted"> &middot; <%= course.teacher %></span>
                    <% end %>
                  </div>
                  <span class="small text-muted"><%= course.year %></span>
                </p>
              <% end %>
            <% end %>
          </div>
        </div>
      </div>
      <% if policy(@user).edit? or policy(@user).impersonate? %>
        <div class="card-actions card-border">
          <% if policy(@user).impersonate? %>
            <%= link_to t("layout.impersonate.impersonate"), impersonate_user_path(@user), class: "btn-text"  %>
          <% end %>
          <% if policy(@user).edit? %>
            <%= link_to t(".edit"), edit_user_path(@user), class: "btn-text btn-primary"  %>
        <% end %>
        </div>
      <% end %>
    </div>
    <div class="card">
      <div class="card-supporting-text">
        <%= render partial: 'visualizations/punchcard' %>
      </div>
    </div>
  </div>
</div>

